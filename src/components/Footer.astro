---
import logo from '/public/images/logo.png';
import { Image } from 'astro:assets';
const currentYear = new Date().getFullYear();
const base = import.meta.env.BASE_URL;

// Footer navigation links
const footerLinks = {
  'Content': [
    { name: 'All Posts', href: '/blog' },
    { name: 'Categories', href: '/categories' },
    { name: 'Tags', href: '/tags' },
    { name: 'Archive', href: '/archive' }
  ],
  'About': [
    { name: 'About Us', href: '/about' },
    { name: 'Contact', href: '/contact' },
    { name: 'Privacy Policy', href: '/privacy' },
    { name: 'Terms of Service', href: '/terms' }
  ],
  'Resources': [
    { name: 'RSS Feed', href: '/rss.xml' },
    { name: 'Sitemap', href: '/sitemap-index.xml' },
    { name: 'Documentation', href: '/docs' },
    { name: 'API', href: '/api' }
  ]
};

// Social media links
const socialLinks = [
  {
    name: 'Twitter',
    href: 'https://twitter.com/laoutarisp',
    icon: 'M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z'
  },
  {
    name: 'GitHub',
    href: 'https://github.com/powergr',
    icon: 'M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22'
  },
  {
    name: 'LinkedIn',
    href: 'https://linkedin.com/in/laoutaris',
    icon: 'M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z M4 6a2 2 0 100-4 2 2 0 000 4z'
  },
{
  name: 'Instagram',
  href: 'https://instagram.com/laoutarisp',
  icon: 'M12 2.163c3.204 0 3.584.012 4.85.07 1.366.062 2.633.326 3.608 1.301.975.975 1.24 2.242 1.301 3.608.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.062 1.366-.326 2.633-1.301 3.608-.975.975-2.242 1.24-3.608 1.301-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.366-.062-2.633-.326-3.608-1.301-.975-.975-1.24-2.242-1.301-3.608-.058-1.266-.07-1.646-.07-4.85s.012-3.584.07-4.85c.062-1.366.326-2.633 1.301-3.608.975-.975 2.242-1.24 3.608-1.301 1.266-.058 1.646-.07 4.85-.07zm0-2.163c-3.259 0-3.667.014-4.947.072-1.628.073-3.078.398-4.238 1.558-1.16 1.16-1.485 2.61-1.558 4.238-.058 1.28-.072 1.688-.072 4.947s.014 3.667.072 4.947c.073 1.628.398 3.078 1.558 4.238 1.16 1.16 2.61 1.485 4.238 1.558 1.28.058 1.688.072 4.947.072s3.667-.014 4.947-.072c1.628-.073 3.078-.398 4.238-1.558 1.16-1.16 1.485-2.61 1.558-4.238.058-1.28.072-1.688.072-4.947s-.014-3.667-.072-4.947c-.073-1.628-.398-3.078-1.558-4.238-1.16-1.16-2.61-1.485-4.238-1.558-1.28-.058-1.688-.072-4.947-.072zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zm0 10.162a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 11-2.88 0 1.44 1.44 0 012.88 0z'
}
];
---

<footer class="bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800">
  <!-- Main footer content -->
  <div class="container-custom section-padding-sm">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      <!-- Brand section -->
      <div class="lg:col-span-2">
        <div class="flex items-center space-x-3 mb-4">
        <a href={base} class="flex items-center space-x-3 text-xl font-bold text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200">
         <!-- The new image tag replaces the old SVG block -->
                  <Image 
            src={logo} 
            alt="CipherFlow Logo" 
            width={64} 
            height={64} 
            format="webp"
            quality="mid"
            class="w-8 h-8" 
          />
  
        <span class="hidden sm:block">CipherFlow</span>
        </a>
        </div>
        <p class="text-gray-600 dark:text-gray-400 mb-6 max-w-md">
         Exploring the ciphers that protect our digital world. CipherFlow is an independent project dedicated to making the principles of modern security visible and accessible to everyone.
        </p>
      
        <!-- Social links -->
        <div class="flex space-x-4">
          {socialLinks.map((social) => (
            <a
              href={social.href}
              class="text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200"
              aria-label={`Follow us on ${social.name}`}
              target="_blank"
              rel="noopener noreferrer"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={social.icon}></path>
              </svg>
            </a>
          ))}
        </div>
      </div>
      <!-- Footer navigation -->
      {Object.entries(footerLinks).map(([category, links]) => (
        <div>
          <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-4">{category}</h3>
          <ul class="space-y-2">
            {links.map((link) => (
              <li>
                <a
                  href=`${base}${link.href}`
                  class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200"
                >
                  {link.name}
                </a>
              </li>
            ))}
          </ul>
        </div>
      ))}
    </div>
  </div>
  
  <!-- Bottom footer -->
  <div class="border-t border-gray-200 dark:border-gray-800">
    <div class="container-custom py-6">
      <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
        <div class="text-sm text-gray-600 dark:text-gray-400">
          <p>Â© {currentYear} CipherFlow. All rights reserved.</p>
        </div>
        
        <div class="flex items-center space-x-6">
          <!-- Legal links -->
          <a href=`${base}/privacy` class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200">
            Privacy
          </a>
          <a href=`${base}/terms` class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200">
            Terms
          </a>
          <a href=`${base}/cookies` class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200">
            Cookies
          </a>
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Cookie consent banner -->
<div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg z-50 no-print hidden">
  <div class="container-custom py-4">
    <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
      <div class="text-sm text-gray-600 dark:text-gray-400">
        <p>
          We use cookies to enhance your experience and analyze our traffic. 
          <a href=`${base}/cookies` class="text-primary-700 dark:text-primary-300 hover:underline">Learn more about our cookie policy</a>
        </p>
      </div>
      <div class="flex items-center space-x-3">
        <button id="cookie-accept" class="btn btn-primary text-sm px-4 py-2">
          Accept
        </button>
        <button id="cookie-decline" class="btn btn-secondary text-sm px-4 py-2">
          Decline
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Cookie consent handling
  const cookieBanner = document.getElementById('cookie-banner');
  const acceptBtn = document.getElementById('cookie-accept');
  const declineBtn = document.getElementById('cookie-decline');

  // Check if user has already made a choice
  const cookieConsent = localStorage.getItem('cookie-consent');
  if (!cookieConsent) {
    // Show banner after a delay
    setTimeout(() => {
      cookieBanner?.classList.remove('hidden');
    }, 2000);
  }

  acceptBtn?.addEventListener('click', () => {
    localStorage.setItem('cookie-consent', 'accepted');
    cookieBanner?.classList.add('hidden');
    
    // Enable analytics or other tracking here
    console.log('Cookies accepted');
  });

  declineBtn?.addEventListener('click', () => {
    localStorage.setItem('cookie-consent', 'declined');
    cookieBanner?.classList.add('hidden');
    
    // Disable analytics or other tracking here
    console.log('Cookies declined');
  });

  // External link handling
  document.querySelectorAll('a[href^="http"]').forEach(link => {
    // This check ensures the element is an anchor tag before trying to access its href property.
    if (link instanceof HTMLAnchorElement) {
      link.addEventListener('click', () => {
        // Add any external link tracking here
        console.log('External link clicked:', link.href);
      });
    }
  });

  // Lazy loading for social media embeds (if any)
  const observerOptions = {
    root: null,
    rootMargin: '50px',
    threshold: 0.1
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const element = entry.target;
        // Load social media widgets or other heavy content
        element.classList.add('loaded');
        observer.unobserve(element);
      }
    });
  }, observerOptions);

  // Observe any elements that need lazy loading
  document.querySelectorAll('[data-lazy]').forEach(el => {
    observer.observe(el);
  });
</script>
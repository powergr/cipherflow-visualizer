---
import BaseLayout from '../layouts/BaseLayout.astro';
const pageTitle = "Contact Us";
const pageDescription = "Get in touch with the CipherFlow team.";
const base = import.meta.env.BASE_URL;
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <div class="max-w-4xl mx-auto px-6 py-12">
    <header class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4">Contact Us</h1>
      <p class="text-xl text-gray-600 dark:text-gray-300">We'd love to hear from you.</p>
    </header>

    <div class="max-w-xl mx-auto">
      <!-- 
        This form's only purpose is to gather data for our JavaScript.
        It posts to the current page, and the script intercepts it.
        It is linked to the "ghost" form via the hidden "form-name" input.
      -->
      <form name="contact" method="POST" class="space-y-6">
        <input type="hidden" name="form-name" value="contact" />
        <p class="hidden"><label>Don’t fill this out if you’re human: <input name="bot-field" /></label></p>
        
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Full Name</label>
          <input type="text" name="name" id="name" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email Address</label>
          <input type="email" name="email" id="email" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-blue-500 focus:border-blue-500" />
        </div>

        <div>
          <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Message</label>
          <textarea name="message" id="message" rows="4" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-blue-500 focus:border-blue-500"></textarea>
        </div>

        <div>
          <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            Send Message
          </button>
        </div>
      </form>
    </div>
  </div>

 <script define:vars={{ base }}>
    const form = document.querySelector('form[name="contact"]');
    
    form.addEventListener('submit', async (event) => {
      event.preventDefault(); // Stop the browser from navigating

      const submitButton = form.querySelector('button[type="submit"]');
      const originalButtonText = submitButton.innerHTML;
      submitButton.disabled = true;
      submitButton.innerHTML = 'Sending...';

      const formData = new FormData(form);

      try {
        const response = await fetch('/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams(formData).toString()
        });

        // --- NEW: Check if the server response was actually successful ---
        if (response.ok) {
          alert("Success! We will now redirect."); // Show a success message for now
          // --- TEMPORARILY DISABLED: This is the redirect we need to stop ---
          // window.location.href = `${base}/thank-you`;
        } else {
          // If the server responded with an error (like 405), throw an error to be caught below
          throw new Error(`Server responded with ${response.status}: ${response.statusText}`);
        }
        
      } catch (error) {
        console.error('Form submission error:', error);
        // --- NEW: Show a more detailed error message to the user ---
        alert(`Sorry, there was an error submitting your form. Please open the developer console to see the details. Error: ${error.message}`);
        submitButton.disabled = false;
        submitButton.innerHTML = originalButtonText;
      }
    });
  </script>
</BaseLayout>